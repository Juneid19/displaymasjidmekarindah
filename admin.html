<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin 20 Event - Masjid Mekarindah</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f3; padding: 20px; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #004d40; border-bottom: 3px solid #ffc107; padding-bottom: 10px; }
        .global-settings { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; background: #e8f5e9; padding: 20px; border-radius: 12px; margin-top: 20px;}
        .grid-events { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .card { background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 12px; position: relative; }
        .card-yt { border: 2px solid #ff0000; background: #fff5f5; }
        .card-text { border: 2px solid #ffc107; background: #fffdf5; }
        .tag { position: absolute; top: -10px; right: 10px; background: #004d40; color: white; padding: 2px 10px; border-radius: 10px; font-size: 0.7rem; font-weight: bold; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.8rem; }
        input, textarea, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn-save { position: fixed; bottom: 30px; right: 30px; width: 200px; padding: 15px; background: #004d40; color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div class="container">
        <h2>Panel Admin Masjid Mekarindah</h2>
        <div class="global-settings">
            <div><label>Khatib / Imam</label><input type="text" id="petugas"></div>
            <div><label>Muadzin</label><input type="text" id="saldo"></div>
            <div><label>Running Text</label><textarea id="marquee"></textarea></div>
        </div>

        <div class="grid-events" id="event-container"></div>
        <button class="btn-save" onclick="saveData()">ðŸ’¾ SIMPAN DATA</button>
        <p id="status" style="text-align:center; margin-top:20px; font-weight:bold;"></p>
    </div>

    <script>
        const BIN_ID = '696e464643b1c97be93ae92e'; 
        const KEY = '$2a$10$wOmw1bmVgdzweWhDNL7ujO8t2zGoWPiQzeLE/IeIhZg//vicMOJnq';

        const container = document.getElementById('event-container');
        for (let i = 0; i < 20; i++) {
            let typeClass = "", typeTag = "POSTER GAMBAR";
            if (i === 9) { typeClass = "card-yt"; typeTag = "YOUTUBE LIVE"; }
            else if (i >= 10) { typeClass = "card-text"; typeTag = "BERITA TEKS"; }

            container.innerHTML += `
                <div class="card ${typeClass}">
                    <span class="tag">${typeTag}</span>
                    <h4 style="margin:0">Slot #${i+1}</h4>
                    <label>Status</label>
                    <select id="act-${i}"><option value="false">Sembunyikan</option><option value="true">Tampilkan</option></select>
                    <label>Judul</label><input type="text" id="tit-${i}">
                    <label>Waktu</label><input type="text" id="dat-${i}">
                    ${i < 10 ? `<label>Link Foto/YT</label><input type="text" id="img-${i}">` : `<input type="hidden" id="img-${i}" value="">`}
                    <label>Keterangan</label><textarea id="des-${i}" rows="3"></textarea>
                </div>`;
        }

        async function loadData() {
            const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: {'X-Master-Key': KEY} });
            const data = (await res.json()).record;
            document.getElementById('petugas').value = data.petugas || '';
            document.getElementById('saldo').value = data.saldo || '';
            document.getElementById('marquee').value = data.marquee || '';
            data.events.forEach((ev, i) => {
                if(i < 20) {
                    document.getElementById(`act-${i}`).value = ev.active || 'false';
                    document.getElementById(`tit-${i}`).value = ev.title || '';
                    document.getElementById(`dat-${i}`).value = ev.date || '';
                    if(document.getElementById(`img-${i}`)) document.getElementById(`img-${i}`).value = ev.img || '';
                    document.getElementById(`des-${i}`).value = ev.desc || '';
                }
            });
        }

        async function saveData() {
            document.getElementById('status').innerText = "Sedang menyimpan...";
            let events = [];
            for(let i=0; i<20; i++) {
                events.push({
                    active: document.getElementById(`act-${i}`).value,
                    title: document.getElementById(`tit-${i}`).value,
                    date: document.getElementById(`dat-${i}`).value,
                    img: document.getElementById(`img-${i}`) ? document.getElementById(`img-${i}`).value : "",
                    desc: document.getElementById(`des-${i}`).value
                });
            }
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: 'PUT', headers: {'Content-Type': 'application/json', 'X-Master-Key': KEY},
                body: JSON.stringify({ petugas: document.getElementById('petugas').value, saldo: document.getElementById('saldo').value, marquee: document.getElementById('marquee').value, events: events })
            });
            document.getElementById('status').innerText = "âœ… Berhasil Diupdate!";
        }
        loadData();
    </script>
</body>
</html>