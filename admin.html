<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Masjid Mekarindah - V18</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f3; padding: 20px; color: #333; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        h2 { text-align: center; color: #004d40; border-bottom: 3px solid #ffc107; padding-bottom: 10px; margin-bottom: 30px; }
        h3 { color: #00796b; margin-top: 30px; border-left: 5px solid #004d40; padding-left: 10px; }
        
        .global-settings { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; background: #e8f5e9; padding: 20px; border-radius: 12px; }
        
        .grid-events { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-top: 20px; }
        
        .card { background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 12px; transition: 0.3s; position: relative; }
        .card:hover { border-color: #00796b; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .card-yt { border: 2px solid #ff0000; background: #fff5f5; } /* Highlight Slot YouTube */
        
        .label-tag { position: absolute; top: -10px; right: 10px; background: #004d40; color: white; padding: 2px 10px; border-radius: 10px; font-size: 0.7rem; font-weight: bold; }
        .tag-yt { background: #ff0000; }
        .tag-text { background: #ffc107; color: #000; }

        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.85rem; color: #555; }
        input, textarea, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 0.9rem; }
        textarea { resize: vertical; }
        
        .btn-save { 
            position: fixed; bottom: 30px; right: 30px; width: 250px; padding: 20px; 
            background: #004d40; color: white; border: none; border-radius: 50px; 
            font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 10px 20px rgba(0,77,64,0.3);
            transition: 0.3s; z-index: 1000;
        }
        .btn-save:hover { background: #00695c; transform: translateY(-3px); }
        
        #status { text-align: center; margin-top: 20px; font-weight: bold; font-size: 1.1rem; }
        .hint { font-size: 0.75rem; color: #777; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h2>Panel Kontrol Display Masjid Mekarindah</h2>

    <!-- INFO GLOBAL DI ADMIN.HTML -->
<h3>1. Informasi Umum Masjid</h3>
<div class="global-settings">
    <div>
        <label>Khatib / Imam</label>
        <input type="text" id="petugas" placeholder="Contoh: Ust. Fauzi / Ust. Salman">
    </div>
    <div>
        <label>Muadzin</label>
        <input type="text" id="saldo" placeholder="Contoh: Bang Bilal">
    </div>
    <div>
        <label>Pesan Running Text</label>
        <textarea id="marquee" placeholder="Mohon luruskan shaf..."></textarea>
    </div>
</div>
    <!-- GRID 15 EVENT -->
    <h3>2. Pengumuman Slider (Maksimal 15 Event)</h3>
    <p class="hint">* Slot 1-9: Gambar. Slot 10: YouTube/Video. Slot 11-15: Teks Saja.</p>
    
    <div class="grid-events" id="event-container">
        <!-- Render Otomatis via JS -->
    </div>

    <div style="height: 100px;"></div> <!-- Spacer -->
    <button class="btn-save" onclick="saveData()">üíæ SIMPAN SEMUA</button>
    <p id="status"></p>
</div>

<script>
    // --- KONFIGURASI JSONBIN ---
    const BIN_ID = '696e464643b1c97be93ae92e'; 
    const KEY = '$2a$10$wOmw1bmVgdzweWhDNL7ujO8t2zGoWPiQzeLE/IeIhZg//vicMOJnq';
    const URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    // Generator Form 15 Slot
    const container = document.getElementById('event-container');
    for (let i = 0; i < 15; i++) {
        let typeClass = "";
        let typeTag = "POSTER GAMBAR";
        let extraHint = "Link Direct ImgBB (.jpg)";
        
        if (i === 9) { 
            typeClass = "card-yt"; 
            typeTag = "YOUTUBE LIVE / VIDEO"; 
            extraHint = "Link Youtube (Watch/Live)";
        } else if (i >= 10) { 
            typeClass = "card-text"; 
            typeTag = "BERITA TEKS"; 
            extraHint = "Tanpa Gambar";
        }

        container.innerHTML += `
            <div class="card ${typeClass}">
                <span class="label-tag ${i===9?'tag-yt':(i>=10?'tag-text':'')}">${typeTag}</span>
                <h4 style="margin-top:5px; color:#004d40;">Slot #${i+1}</h4>
                
                <label>Status Tampil</label>
                <select id="act-${i}">
                    <option value="false">Sembunyikan</option>
                    <option value="true">Tampilkan</option>
                </select>

                <label>Judul Kegiatan</label>
                <input type="text" id="tit-${i}" placeholder="Judul...">

                <label>Tanggal / Waktu</label>
                <input type="text" id="dat-${i}" placeholder="Contoh: Setiap Sabtu, 18.30">

                ${i < 10 ? `
                    <label>Link Foto / Video</label>
                    <input type="text" id="img-${i}" placeholder="${extraHint}">
                ` : `<input type="hidden" id="img-${i}" value="">`}

                <label>Keterangan Deskripsi</label>
                <textarea id="des-${i}" rows="3" placeholder="Isi penjelasan singkat..."></textarea>
            </div>
        `;
    }

    // Fungsi Load Data
    async function loadData() {
        try {
            const res = await fetch(`${URL}/latest`, { headers: {'X-Master-Key': KEY} });
            const data = (await res.json()).record;
            
            // Isi Global
            document.getElementById('petugas').value = data.petugas || '';
            document.getElementById('saldo').value = data.saldo || '';
            document.getElementById('marquee').value = data.marquee || '';
            
            // Isi 15 Event
            data.events.forEach((ev, i) => {
                if(i < 15) {
                    document.getElementById(`act-${i}`).value = ev.active || 'false';
                    document.getElementById(`tit-${i}`).value = ev.title || '';
                    document.getElementById(`dat-${i}`).value = ev.date || '';
                    if(document.getElementById(`img-${i}`)) document.getElementById(`img-${i}`).value = ev.img || '';
                    document.getElementById(`des-${i}`).value = ev.desc || '';
                }
            });
        } catch (e) { 
            document.getElementById('status').innerText = "‚ùå Gagal mengambil data. Cek API Key & Bin ID!";
        }
    }

    // Fungsi Simpan Data
    async function saveData() {
        const status = document.getElementById('status');
        status.innerText = "‚è≥ Sedang menyimpan data ke cloud...";
        status.style.color = "orange";

        let eventArray = [];
        for(let i=0; i<15; i++) {
            eventArray.push({
                active: document.getElementById(`act-${i}`).value,
                title: document.getElementById(`tit-${i}`).value,
                date: document.getElementById(`dat-${i}`).value,
                img: document.getElementById(`img-${i}`) ? document.getElementById(`img-${i}`).value : "",
                desc: document.getElementById(`des-${i}`).value
            });
        }

        const payload = {
            petugas: document.getElementById('petugas').value,
            saldo: document.getElementById('saldo').value,
            marquee: document.getElementById('marquee').value,
            events: eventArray
        };

        try {
            const res = await fetch(URL, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', 'X-Master-Key': KEY },
                body: JSON.stringify(payload)
            });
            if(res.ok) {
                status.innerText = "‚úÖ BERHASIL! Data TV telah diperbarui.";
                status.style.color = "green";
                setTimeout(() => { status.innerText = ""; }, 3000);
            } else { throw new Error(); }
        } catch (e) {
            status.innerText = "‚ùå GAGAL! Terjadi kesalahan koneksi.";
            status.style.color = "red";
        }
    }

    // Jalankan load data saat halaman dibuka
    loadData();
</script>

</body>
</html>
